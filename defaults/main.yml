---
# defaults file for mariadb-server

# Simple placeholder to allow other roles to detect this role
mariadb_server__role: True

# Enable fact deployment
mariadb_server__facts: True

# Choose the monitoring backend to configure (if available)
#mariadb_server__monitoring:

# List of package to remove
mariadb_server__conflict_packages_names: []

# List of packages required for Mariadb to install
mariadb_server__required_packages_names: []

# Base url for repostories
#mariadb_server__repository_base_url:

# The MariaDB version to install
mariadb_server__version: 10.2


### SERVICE CONFIGURATION
# ---------------------------------------
# The name of the systemd mariadb service
mariadb_server__service_name: mariadb

# If true the mariadb service will be started and enabled
mariadb_server__service_enabled: True

# If this is set to true, ansible will automatically restart mariadb daemon on changes
mariadb_server__service_restartable: True

# Path to the must restart stamp file
mariadb_server__service_restart_stamp_file: '/var/local/mariadb-must-restart-stamp'

# Path to systemd override directory
mariadb_server__systemd_override_options_dir: '/etc/systemd/system/{{ mariadb_server__service_name }}.service.d/'

# Place to save run files
mariadb_server__run_dir: /var/run/mysqld

# Prevent Mariadb to load other configuration file
mariadb_server__service_options:
  - '--defaults-file={{ mariadb_server__main_configuration_file }}'

# Service user configuration
mariadb_server__user_runas: mysql
mariadb_server__group_runas: mysql


### SQL ENTITIES
# ---------------------------------------
# Specify name of root account to use for ansible configuration
mariadb_server__root_login: 'root'
# Specify an optional password to setup and to use for root account
#mariadb_server__root_password:

# List of user to create
mariadb_server__users: []
# List of database to create
mariadb_server__databases: {}

# Monitoring user credentials
#mariadb_server__monitoring_username:
#mariadb_server__monitoring_password:


### SERVER CONFIGURATION
# ---------------------------------------
# Main configuration directory
mariadb_server__configuration_dir: /etc/mysql
# Main configuration file
mariadb_server__main_configuration_file: '{{ mariadb_server__configuration_dir }}/my.cnf'
# Copy the configuration template to all theses place too
mariadb_server__configuration_alternates_files: []
# File which contains server specific configurations
mariadb_server__server_configuration_file: '{{ mariadb_server__configuration_dir }}/server.cnf'
# Directory where to put included files
mariadb_server__include_configuration_dir: '{{ mariadb_server__configuration_dir }}/conf.d'

# Name of the mariadb client binary
mariadb_server__client_executable: mariadb

# Executable use to check configuration files
mariadb_server__configuration_validator: '{{ mariadb_server__client_executable }} --defaults-file=%s --help'


### DATABASE BOOTSTRAPING
# ---------------------------------------
# This path is used to determine if the database is initialized or not
mariadb_server__initdb_check_file: '{{ mariadb_server__datadir }}/mysql'

# Allow insecure root account (available using tcp socket)
mariadb_server__initdb_insecure: True


### NETWORK SECTION
# ---------------------------------------
# Bind address for network
mariadb_server__bind_address: 0.0.0.0
mariadb_server__bind_port: 3306
mariadb_server__skip_networking: False
mariadb_server__socket_file: '{{ mariadb_server__run_dir }}/mysqld.sock'
mariadb_server__max_connections: 100
mariadb_server__max_user_connections: 0

mariadb_server__skip_name_resolve: True


### GENERAL SECTION
# ---------------------------------------
mariadb_server__pid_file: '{{ mariadb_server__run_dir }}/mysqld.pid'
mariadb_server__datadir: /var/lib/mysql
mariadb_server__tmpdir: /tmp
mariadb_server__basedir: /usr
mariadb_server__lc_messages_dir: /usr/share/mysql
mariadb_server__lc_messages: en_us

mariadb_server__collation_server: utf8_general_ci

mariadb_server__character_sets_dir: /usr/share/mysql/charsets/
mariadb_server__character_set_filesystem: binary
mariadb_server__character_set_server: utf8

# Choose default store engine if not precised in create table
mariadb_server__default_storage_engine: InnoDB


### LOG SECTION
# ---------------------------------------
mariadb_server__log_dir: /var/log/mysql

# Both location gets rotated by the cronjob.
# Be aware that this log type is a performance killer.
mariadb_server__general_log: False
mariadb_server__general_log_file: '{{ mariadb_server__log_dir }}/general/mysql.log'

mariadb_server__log_warnings: 2
mariadb_server__error_log_file: '{{ mariadb_server__log_dir }}/error/error.log'

mariadb_server__slow_query_log: False
mariadb_server__slow_query_log_file: '{{ mariadb_server__log_dir }}/slow-query/mysql-slow.log'

mariadb_server__long_query_time: 2

# Binary log
mariadb_server__binlog_enabled: False
mariadb_server__binlog_dir: '{{ mariadb_server__log_dir }}/binlog'
mariadb_server__expire_logs_days: 0
mariadb_server__max_binlog_size: 1G
mariadb_server__binlog_do_db: []
mariadb_server__binlog_ignore_db: []

# Aria log
mariadb_server__aria_log_dir: '{{ mariadb_server__log_dir }}/arialog'
mariadb_server__aria_log_purge_type: immediate
mariadb_server__aria_log_file_size: 100M

# InnoDB log
mariadb_server__innodb_log_dir: '{{ mariadb_server__log_dir }}/redolog'


### REPLICATION SECTION
# ---------------------------------------
mariadb_server__replication_enabled: False
# Set a random number in the available range
mariadb_server__server_id: '{{ 4294967290|random(seed=inventory_hostname)+1 }}'

mariadb_server__replicate_do_db: []
mariadb_server__replicate_ignore_db: []
mariadb_server__replicate_do_table: []
mariadb_server__replicate_ignore_table: []

mariadb_server__replicate_wild_do_table: []
mariadb_server__replicate_wild_ignore_table: []



mariadb_server__skip_external_locking: True

mariadb_server__performance_schema: True


# select mode for query cache
mariadb_server__query_cache_type: '0'

# Add query cache settings
# This variable is intended to be used in Ansible’s global inventory.
mariadb_server__query_cache_global_parameters: {}

# This variable is intended to be used in a host inventory group of Ansible
# (only one host group is supported).
mariadb_server__query_cache_group_parameters: {}

# This variable is intended to be used in the inventory of hosts.
mariadb_server__query_cache_host_parameters: {}

# Combine all customs parameters
mariadb_server__query_cache_parameters: '{{ mariadb_server__query_cache_global_parameters
                                | combine(mariadb_server__query_cache_group_parameters)
                                | combine(mariadb_server__query_cache_host_parameters) }}'



# This variable is intended to be used in Ansible’s global inventory.
mariadb_server__tuning_global_parameters: {}

# This variable is intended to be used in a host inventory group of Ansible
# (only one host group is supported).
mariadb_server__tuning_group_parameters: {}

# This variable is intended to be used in the inventory of hosts.
mariadb_server__tuning_host_parameters: {}

# Combine all customs parameters
mariadb_server__tuning_parameters: '{{ mariadb_server__tuning_global_parameters
                                | combine(mariadb_server__tuning_group_parameters)
                                | combine(mariadb_server__tuning_host_parameters) }}'


### INNODB
# ---------------------------------------
mariadb_server__innodb_data_home_dir: '{{ mariadb_server__datadir }}'
# This variable is intended to be used in Ansible’s global inventory.
mariadb_server__innodb_global_parameters: {}

# This variable is intended to be used in a host inventory group of Ansible
# (only one host group is supported).
mariadb_server__innodb_group_parameters: {}

# This variable is intended to be used in the inventory of hosts.
mariadb_server__innodb_host_parameters: {}

mariadb_server__innodb_parameters: '{{ mariadb_server__innodb_global_parameters
                                | combine(mariadb_server__innodb_group_parameters)
                                | combine(mariadb_server__innodb_host_parameters) }}'

## MyISAM
# This variable is intended to be used in Ansible’s global inventory.
mariadb_server__myisam_global_parameters: {}

# This variable is intended to be used in a host inventory group of Ansible
# (only one host group is supported).
mariadb_server__myisam_group_parameters: {}

# This variable is intended to be used in the inventory of hosts.
mariadb_server__myisam_host_parameters: {}

mariadb_server__myisam_parameters: '{{ mariadb_server__myisam_global_parameters
                                | combine(mariadb_server__myisam_group_parameters)
                                | combine(mariadb_server__myisam_host_parameters) }}'


### CLIENTS CONFIGURATION SECTION
# ---------------------------------------
mariadb_server__clients_defaults_parameters:
  client:
    socket: '{{ mariadb_server__socket_file }}'
    port: '{{ mariadb_server__bind_port|int }}'
    default-character-set: '{{ mariadb_server__character_set_server }}'
#    ssl-cert: /etc/mysql/client-cert.pem
#    ssl-key: /etc/mysql/client-key.pem
#    ssl-verify-server-cert: on
  mysql:
    no-auto-rehash:
    prompt: "\"{{ mariadb_server__clients_prompt|d('MariaDB') }}> \""
    safe-updates:
    show-warnings:
  mysql_upgrade: {}
  mysqladmin: {}
  mysqlbinlog: {}
  mysqlcheck: {}
  mysqldump:
    quick:
    quote-names:
    max_allowed_packet: 16M
  mysqld_safe:
    socket: '{{ mariadb_server__socket_file }}'
    nice: 0
    skip_log_error:
    syslog:
  mysqlimport: {}
  mysqlshow: {}
  mysqlslap: {}
  isamchk:
    key_buffer: 16M

# This variable is intended to be used in Ansible’s global inventory.
mariadb_server__clients_global_parameters: {}

# This variable is intended to be used in a host inventory group of Ansible
# (only one host group is supported).
mariadb_server__clients_group_parameters: {}

# This variable is intended to be used in the inventory of hosts.
mariadb_server__clients_host_parameters: {}

# final merged parameters
mariadb_server__clients_parameters: '{{ mariadb_server__clients_defaults_parameters
                                | combine(mariadb_server__clients_global_parameters)
                                | combine(mariadb_server__clients_group_parameters)
                                | combine(mariadb_server__clients_host_parameters) }}'

# TLS configuration
#mariadb_server__ssl_ca:
#mariadb_server__ssl_capath:
#mariadb_server__ssl_cert: 
#mariadb_server__ssl_key: 
#mariadb_server__ssl_cipher:
#mariadb_server__ssl_crl:
#mariadb_server__ssl_crlpath:


# List of GPG keys to add
mariadb_server__gpg_keys:
  Debian:
    - id:        177F4010FE56CA3336300305F1656F24C74CD1D8
      keyserver: keyserver.ubuntu.com
